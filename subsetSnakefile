from snakemake.utils import validate
import json
#import tarfile
#from math import floor
#from os.path import isfile

validate(config, "schema/subsetConfig.schema.json")
print(json.dumps(config, indent=4))

sample = config["sample"]

rule run_subset:
    input:
        config["index"]
    output:
        index = f"{sample}_index.tar"
    conda:
        "config/requirements.yml"
    params:
        genomes = config["genomes"],
        exclusive = config["exclusive"]
    threads:
        config["threads"]
    shell:
        """
        if [ "{params.exclusive}" = "True" ]; then
            echo "running: pankmer subset -x -i {input} -g {params.genomes} --gzip-level 1 -o {output.index}"
            pankmer subset -x -i {input} -g {params.genomes} --gzip-level 1 -o {output.index}
        else
            echo "running: pankmer subset -i {input} -g {params.genomes} --gzip-level 1 -o {output.index}"
            pankmer subset -i {input} -g {params.genomes} --gzip-level 1 -o {output.index}
        fi
        """